<!DOCTYPE html><html><head><meta charset="utf-8"><title>2048</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet"><style>*{box-sizing:border-box}html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;font-family:'Outfit','Clear Sans',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;color:#ffffff;background:transparent;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}#bg-canvas{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-1;pointer-events:none}.game-wrapper{display:flex;flex-direction:column;width:100%;height:100vh;height:100dvh;padding:clamp(10px,2vh,20px);gap:clamp(10px,2vh,15px)}.game-header{display:flex;justify-content:space-between;align-items:center;gap:15px;flex-wrap:wrap;padding:clamp(12px,2vh,20px);background:rgba(15,23,42,0.4);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.1);border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.2)}.header-left{display:flex;flex-direction:column;gap:2px}.title{margin:0;font-size:clamp(24px,5vw,40px);font-weight:700;letter-spacing:2px;background:linear-gradient(135deg,#3b82f6,#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1}.subtitle{margin:0;font-size:clamp(10px,2vw,13px);color:rgba(255,255,255,0.6);letter-spacing:1px;text-transform:uppercase}.header-right{display:flex;gap:10px}.score-box{display:flex;flex-direction:column;align-items:center;justify-content:center;min-width:clamp(60px,15vw,80px);padding:clamp(8px,1.5vh,12px) clamp(12px,3vw,20px);background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;transition:all 0.3s ease}.score-box.best{background:rgba(59,130,246,0.1);border-color:rgba(59,130,246,0.3)}.score-label{font-size:clamp(9px,2vw,11px);color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:1px;margin-bottom:2px}.score-value{font-size:clamp(18px,4vw,28px);font-weight:700;color:#ffffff;position:relative}.score-addition{position:absolute;top:-25px;right:0;color:#10b981;font-size:clamp(14px,3vw,20px);font-weight:700;animation:scoreFloat 0.6s ease-out;pointer-events:none}@keyframes scoreFloat{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-30px)}}.controls-bar{display:flex;gap:10px;justify-content:center}.btn{display:flex;align-items:center;justify-content:center;gap:8px;padding:clamp(10px,2vh,14px) clamp(16px,4vw,24px);border:none;border-radius:8px;font-family:inherit;font-size:clamp(13px,2.5vw,15px);font-weight:600;cursor:pointer;transition:all 0.2s ease;backdrop-filter:blur(10px);text-decoration:none;color:#ffffff;white-space:nowrap}.btn-icon{font-size:clamp(16px,3vw,20px);line-height:1}.btn-text{line-height:1}.btn-primary{background:linear-gradient(135deg,#3b82f6,#2563eb);box-shadow:0 4px 12px rgba(59,130,246,0.3)}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(59,130,246,0.4)}.btn-primary:active{transform:translateY(0)}.btn-secondary{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);box-shadow:0 4px 12px rgba(0,0,0,0.2)}.btn-secondary:hover{background:rgba(255,255,255,0.15);transform:translateY(-2px)}.game-container-wrapper{flex:1;display:flex;align-items:center;justify-content:center;min-height:0}.game-container{position:relative;width:100%;max-width:min(500px,calc(100vh - 250px),calc(100vw - 40px));aspect-ratio:1;padding:clamp(10px,2vw,15px);background:rgba(255,255,255,0.08);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.15);border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.3);user-select:none;-webkit-user-select:none;touch-action:none;transition:transform 0.3s ease}.grid-container{position:absolute;inset:clamp(10px,2vw,15px);display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(4,1fr);gap:clamp(8px,1.5vw,15px);z-index:1}.grid-row{display:contents}.grid-cell{background:rgba(0,0,0,0.25);border-radius:8px;box-shadow:inset 0 2px 4px rgba(0,0,0,0.2)}.tile-container{position:absolute;inset:clamp(10px,2vw,15px);z-index:2;pointer-events:none}.tile{position:absolute;width:var(--tile-size);height:var(--tile-size);transition:100ms ease-in-out;transition-property:transform}.tile-inner{display:flex;align-items:center;justify-content:center;width:100%;height:100%;border-radius:8px;font-weight:700;font-size:clamp(24px,5vw,55px);box-shadow:0 4px 8px rgba(0,0,0,0.15)}.tile-2 .tile-inner{background:#e2e8f0;color:#334155}.tile-4 .tile-inner{background:#cbd5e1;color:#334155}.tile-8 .tile-inner{background:#60a5fa;color:#ffffff}.tile-16 .tile-inner{background:#3b82f6;color:#ffffff}.tile-32 .tile-inner{background:#8b5cf6;color:#ffffff}.tile-64 .tile-inner{background:#a855f7;color:#ffffff}.tile-128 .tile-inner{background:#d946ef;color:#ffffff;font-size:clamp(20px,4.5vw,45px)}.tile-256 .tile-inner{background:#ec4899;color:#ffffff;font-size:clamp(20px,4.5vw,45px)}.tile-512 .tile-inner{background:#f43f5e;color:#ffffff;font-size:clamp(20px,4.5vw,45px)}.tile-1024 .tile-inner{background:#ef4444;color:#ffffff;font-size:clamp(18px,4vw,35px)}.tile-2048 .tile-inner{background:#f59e0b;color:#ffffff;font-size:clamp(18px,4vw,35px)}.tile-super .tile-inner{background:#1e293b;color:#ffffff;font-size:clamp(16px,3.5vw,30px);box-shadow:0 0 30px rgba(245,158,11,0.6)}.tile-256 .tile-inner{animation:subtleGlow 3s ease-in-out infinite}.tile-512 .tile-inner{animation:heatGlow 2s ease-in-out infinite;box-shadow:0 4px 15px rgba(244,63,94,0.4),0 0 30px rgba(244,63,94,0.2)}.tile-1024 .tile-inner{animation:intenseHeat 1.5s ease-in-out infinite;box-shadow:0 4px 20px rgba(239,68,68,0.5),0 0 40px rgba(239,68,68,0.3)}.tile-2048 .tile-inner{animation:criticalHeat 1s ease-in-out infinite;box-shadow:0 4px 25px rgba(245,158,11,0.6),0 0 50px rgba(245,158,11,0.4),0 0 80px rgba(245,158,11,0.2)}@keyframes subtleGlow{0%,100%{box-shadow:0 4px 10px rgba(236,72,153,0.4)}50%{box-shadow:0 4px 20px rgba(236,72,153,0.6),0 0 30px rgba(236,72,153,0.2)}}@keyframes heatGlow{0%,100%{box-shadow:0 4px 15px rgba(244,63,94,0.4),0 0 30px rgba(244,63,94,0.15);transform:scale(1)}50%{box-shadow:0 4px 25px rgba(244,63,94,0.6),0 0 45px rgba(244,63,94,0.3);transform:scale(1.02)}}@keyframes intenseHeat{0%,100%{box-shadow:0 4px 20px rgba(239,68,68,0.5),0 0 40px rgba(239,68,68,0.2);transform:scale(1)}50%{box-shadow:0 4px 30px rgba(239,68,68,0.7),0 0 60px rgba(239,68,68,0.35);transform:scale(1.03)}}@keyframes criticalHeat{0%,100%{box-shadow:0 4px 25px rgba(245,158,11,0.5),0 0 50px rgba(245,158,11,0.3);transform:scale(1)}50%{box-shadow:0 4px 35px rgba(245,158,11,0.8),0 0 70px rgba(245,158,11,0.45),0 0 100px rgba(245,158,11,0.15);transform:scale(1.04)}}.tile-new .tile-inner{animation:tileAppear 200ms ease 150ms backwards}.tile-merged .tile-inner{animation:tilePop 200ms ease 150ms backwards;z-index:20}@keyframes tileAppear{0%{opacity:0;transform:scale(0)}100%{opacity:1;transform:scale(1)}}@keyframes tilePop{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}.game-message{display:none;position:absolute;inset:0;background:rgba(15,23,42,0.95);backdrop-filter:blur(8px);border-radius:12px;z-index:100;flex-direction:column;align-items:center;justify-content:center;gap:20px;animation:fadeIn 0.5s ease}.game-message.game-won,.game-message.game-over{display:flex}.game-message p{margin:0;font-size:clamp(32px,8vw,60px);font-weight:700;text-align:center;line-height:1.2}.game-message .lower{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}.game-message .btn{padding:12px 24px;font-size:14px}.game-message .keep-playing-button{display:none}.game-message.game-won .keep-playing-button{display:flex}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.game-footer{text-align:center;padding:clamp(8px,1.5vh,12px)}.instructions{margin:0;font-size:clamp(11px,2.2vw,14px);color:rgba(255,255,255,0.6);line-height:1.5;display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap}.instructions-icon{font-size:clamp(14px,3vw,18px)}.instructions strong{color:rgba(255,255,255,0.9)}:root{--tile-size:106px;--tile-gap:15px}@media screen and (max-width:600px){:root{--tile-gap:10px}}.tile-position-1-1{transform:translate(calc(0 * (var(--tile-size) + var(--tile-gap))),calc(0 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-1-2{transform:translate(calc(0 * (var(--tile-size) + var(--tile-gap))),calc(1 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-1-3{transform:translate(calc(0 * (var(--tile-size) + var(--tile-gap))),calc(2 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-1-4{transform:translate(calc(0 * (var(--tile-size) + var(--tile-gap))),calc(3 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-2-1{transform:translate(calc(1 * (var(--tile-size) + var(--tile-gap))),calc(0 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-2-2{transform:translate(calc(1 * (var(--tile-size) + var(--tile-gap))),calc(1 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-2-3{transform:translate(calc(1 * (var(--tile-size) + var(--tile-gap))),calc(2 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-2-4{transform:translate(calc(1 * (var(--tile-size) + var(--tile-gap))),calc(3 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-3-1{transform:translate(calc(2 * (var(--tile-size) + var(--tile-gap))),calc(0 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-3-2{transform:translate(calc(2 * (var(--tile-size) + var(--tile-gap))),calc(1 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-3-3{transform:translate(calc(2 * (var(--tile-size) + var(--tile-gap))),calc(2 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-3-4{transform:translate(calc(2 * (var(--tile-size) + var(--tile-gap))),calc(3 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-4-1{transform:translate(calc(3 * (var(--tile-size) + var(--tile-gap))),calc(0 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-4-2{transform:translate(calc(3 * (var(--tile-size) + var(--tile-gap))),calc(1 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-4-3{transform:translate(calc(3 * (var(--tile-size) + var(--tile-gap))),calc(2 * (var(--tile-size) + var(--tile-gap)))) !important}.tile-position-4-4{transform:translate(calc(3 * (var(--tile-size) + var(--tile-gap))),calc(3 * (var(--tile-size) + var(--tile-gap)))) !important}@media screen and (max-width:600px){.game-wrapper{padding:8px;gap:8px}.game-header{padding:12px}.header-right{gap:6px}.score-box{min-width:55px;padding:6px 10px}.controls-bar{gap:8px}.btn{padding:10px 14px;font-size:13px}.btn-text{display:none}.btn-icon{font-size:20px}.instructions{font-size:11px}}@media screen and (max-height:500px) and (orientation:landscape){.game-wrapper{padding:5px;gap:5px}.game-header{padding:8px}.title{font-size:20px}.subtitle{font-size:9px}.controls-bar{gap:5px}.btn{padding:6px 10px}.game-footer{display:none}}@media screen and (min-width:600px) and (max-width:900px){.game-container{max-width:min(450px,calc(100vh - 200px))}}@media screen and (min-width:900px){.game-wrapper{max-width:600px;margin:0 auto}}</style><link rel="shortcut icon" href="favicon.ico"><link rel="apple-touch-icon" href="meta/apple-touch-icon.png"><link rel="apple-touch-startup-image" href="meta/apple-touch-startup-image-640x1096.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"><link rel="apple-touch-startup-image" href="meta/apple-touch-startup-image-640x920.png" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"></head><body><canvas id="bg-canvas"></canvas><div class="game-wrapper"><header class="game-header"><div class="header-left"><h1 class="title">2048</h1><p class="subtitle">Vector de Reentrada</p></div><div class="header-right"><div class="score-box"><span class="score-label">Score</span><span class="score-value score-container">0</span></div><div class="score-box best"><span class="score-label">Best</span><span class="score-value best-container">0</span></div></div></header><div class="controls-bar"><button class="btn btn-secondary mission-button" onclick="if(typeof MissionBriefing !== 'undefined') { localStorage.removeItem('missionBriefingShown'); new MissionBriefing(); }"><span class="btn-icon">üì°</span><span class="btn-text">Misi√≥n</span></button><button class="btn btn-primary restart-button"><span class="btn-icon">üîÑ</span><span class="btn-text">Nuevo Juego</span></button></div><div class="game-container-wrapper"><div class="game-container"><div class="game-message"><p></p><div class="lower"><button class="btn btn-secondary keep-playing-button">Continuar</button><button class="btn btn-primary retry-button">Reintentar</button></div></div><div class="grid-container"><div class="grid-row"><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div></div><div class="grid-row"><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div></div><div class="grid-row"><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div></div><div class="grid-row"><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div><div class="grid-cell"></div></div></div><div class="tile-container"></div></div></div><footer class="game-footer"><p class="instructions"><span class="instructions-icon">‚å®Ô∏è</span> Usa las <strong>flechas</strong> para mover. Fusiona n√∫meros iguales. Objetivo: <strong>2048 m/s</strong></p></footer></div><script>Function.prototype.bind = Function.prototype.bind || function(target){var self = this;return function(args){if(!(args instanceof Array)){args = [args];}self.apply(target,args);};};(function(){if(typeof window.Element === "undefined" || "classList" in document.documentElement){return;}var prototype = Array.prototype,push = prototype.push,splice = prototype.splice,join = prototype.join;function DOMTokenList(el){this.el = el;var classes = el.className.replace(/^\s+|\s+$/g,'').split(/\s+/);for(var i = 0;i < classes.length;i++){push.call(this,classes[i]);}}DOMTokenList.prototype ={add:function(token){if(this.contains(token))return;push.call(this,token);this.el.className = this.toString();},contains:function(token){return this.el.className.indexOf(token)!= -1;},item:function(index){return this[index] || null;},remove:function(token){if(!this.contains(token))return;for(var i = 0;i < this.length;i++){if(this[i] == token)break;}splice.call(this,i,1);this.el.className = this.toString();},toString:function(){return join.call(this,' ');},toggle:function(token){if(!this.contains(token)){this.add(token);}else{this.remove(token);}return this.contains(token);}};window.DOMTokenList = DOMTokenList;function defineElementGetter(obj,prop,getter){if(Object.defineProperty){Object.defineProperty(obj,prop,{get:getter});}else{obj.__defineGetter__(prop,getter);}}defineElementGetter(HTMLElement.prototype,'classList',function(){return new DOMTokenList(this);});})();(function(){var lastTime = 0;var vendors = ['webkit','moz'];for(var x = 0;x < vendors.length && !window.requestAnimationFrame;++x){window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];}if(!window.requestAnimationFrame){window.requestAnimationFrame = function(callback){var currTime = new Date().getTime();var timeToCall = Math.max(0,16 -(currTime - lastTime));var id = window.setTimeout(function(){callback(currTime + timeToCall);},timeToCall);lastTime = currTime + timeToCall;return id;};}if(!window.cancelAnimationFrame){window.cancelAnimationFrame = function(id){clearTimeout(id);};}}());function ResponsiveHelper(){this.updateDimensions();window.addEventListener('resize',this.updateDimensions.bind(this));window.addEventListener('orientationchange',this.updateDimensions.bind(this));}ResponsiveHelper.prototype.updateDimensions = function(){var container = document.querySelector('.game-container');if(!container)return;var containerRect = container.getBoundingClientRect();var computedStyle = window.getComputedStyle(container);var padding = parseFloat(computedStyle.padding)|| 15;var gridSize = containerRect.width -(padding * 2);var gap;if(window.innerWidth < 400){gap = 8;}else if(window.innerWidth < 600){gap = 10;}else{gap = 15;}var cellSize =(gridSize -(gap * 3))/ 4;this.cellSize = Math.floor(cellSize);this.gap = gap;this.padding = padding;document.documentElement.style.setProperty('--tile-size',this.cellSize + 'px');document.documentElement.style.setProperty('--tile-gap',gap + 'px');console.log('Updated dimensions:',{containerWidth:containerRect.width,padding:padding,gridSize:gridSize,gap:gap,cellSize:this.cellSize});};ResponsiveHelper.prototype.updateAllTiles = function(){var tiles = document.querySelectorAll('.tile');tiles.forEach(function(tile){var classes = tile.className.match(/tile-position-(\d)-(\d)/);if(classes){var x = parseInt(classes[1])- 1;var y = parseInt(classes[2])- 1;var pos = this.getTilePosition(x,y);tile.style.transform = 'translate(' + pos.x + 'px,' + pos.y + 'px)';}}.bind(this));};ResponsiveHelper.prototype.getTilePosition = function(x,y){return{x:x *(this.cellSize + this.gap),y:y *(this.cellSize + this.gap)};};ResponsiveHelper.prototype.getCellSize = function(){return this.cellSize || 106;};ResponsiveHelper.prototype.getGap = function(){return this.gap || 15;};function EventBus(){this.events ={};}EventBus.prototype.on = function(event,callback){if(!this.events[event]){this.events[event] = [];}this.events[event].push(callback);var self = this;return function(){self.off(event,callback);};};EventBus.prototype.off = function(event,callback){if(!this.events[event])return;var index = this.events[event].indexOf(callback);if(index > -1){this.events[event].splice(index,1);}};EventBus.prototype.emit = function(event,data){if(!this.events[event])return;this.events[event].forEach(function(callback){try{callback(data);}catch(e){console.error('Error in event handler for "' + event + '":',e);}});};EventBus.prototype.once = function(event,callback){var self = this;var wrappedCallback = function(data){callback(data);self.off(event,wrappedCallback);};this.on(event,wrappedCallback);};EventBus.prototype.clear = function(){this.events ={};};function MissionBriefing(){this.shown = localStorage.getItem('missionBriefingShown')=== 'true';this.overlay = null;if(!this.shown){this.show();}}MissionBriefing.prototype.show = function(){var self = this;this.overlay = document.createElement('div');this.overlay.id = 'mission-briefing';this.overlay.style.cssText = 'position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.92);z-index:9999;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(20px);animation:fadeIn 0.4s ease;padding:20px;box-sizing:border-box;overflow-y:auto;';var content = document.createElement('div');content.style.cssText = 'max-width:min(550px,100%);width:100%;padding:clamp(24px,5vw,40px);background:rgba(15,23,42,0.85);border:1px solid rgba(59,130,246,0.3);border-radius:16px;color:#fff;font-family:"Outfit",-apple-system,BlinkMacSystemFont,sans-serif;box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 80px rgba(59,130,246,0.2);animation:slideUp 0.5s cubic-bezier(0.34,1.56,0.64,1);backdrop-filter:blur(12px);';content.innerHTML = '<div style="text-align:center;margin-bottom:clamp(20px,5vh,32px);">' + '<div style="font-size:clamp(40px,10vw,56px);margin-bottom:12px;filter:drop-shadow(0 0 20px rgba(59,130,246,0.5));">üõ∞Ô∏è</div>' + '<h1 style="margin:0;font-size:clamp(24px,6vw,36px);font-weight:700;background:linear-gradient(135deg,#60a5fa,#3b82f6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:2px;">MISSION CRITICAL</h1>' + '<div style="font-size:clamp(10px,2.5vw,12px);color:rgba(255,255,255,0.5);margin-top:8px;letter-spacing:2px;text-transform:uppercase;">C√°lculo de Reentrada</div>' + '</div>' + '<div style="background:rgba(0,0,0,0.25);padding:clamp(16px,4vw,24px);border-left:3px solid #3b82f6;margin-bottom:clamp(20px,4vh,28px);line-height:1.7;font-size:clamp(13px,3vw,15px);border-radius:0 8px 8px 0;">' + '<p style="margin:0 0 16px 0;">Eres el <strong style="color:#60a5fa;">oficial de navegaci√≥n</strong> de la estaci√≥n espacial <strong style="color:#f59e0b;">2048</strong>,en √≥rbita a 400km sobre la Tierra.</p>' + '<p style="margin:0 0 16px 0;">Una <strong style="color:#f43f5e;">tormenta solar geomagn√©tica de clase X</strong> ha destruido todos los sistemas de computaci√≥n. La tripulaci√≥n tiene ox√≠geno para <strong style="color:#f43f5e;">48 horas</strong>.</p>' + '<p style="margin:0;">Debes calcular la <strong style="color:#10b981;">secuencia de reentrada</strong>. Cada n√∫mero representa un vector en m/s.</p>' + '</div>' + '<div style="background:linear-gradient(135deg,rgba(59,130,246,0.08),rgba(59,130,246,0.15));padding:clamp(16px,4vw,24px);border-radius:12px;margin-bottom:clamp(20px,4vh,28px);border:1px solid rgba(59,130,246,0.25);">' + '<div style="font-size:clamp(10px,2.5vw,11px);color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px;display:flex;align-items:center;gap:6px;"><span style="font-size:14px;">üéØ</span> Objetivo</div>' + '<div style="font-size:clamp(16px,4vw,20px);font-weight:700;color:#f59e0b;margin-bottom:8px;">Vector 2048 m/s</div>' + '<div style="font-size:clamp(11px,2.8vw,13px);color:rgba(255,255,255,0.6);">Aterrizaje seguro en el Oc√©ano Pac√≠fico</div>' + '</div>' + '<div style="text-align:center;font-size:clamp(12px,3vw,14px);color:rgba(255,255,255,0.4);margin-bottom:clamp(24px,5vh,32px);font-style:italic;padding:0 16px;">' + '"El tiempo corre. La atm√≥sfera te espera."' + '</div>' + '<div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">' + '<button id="start-mission" class="mission-btn-primary" style="flex:1;min-width:140px;padding:clamp(12px,3vw,16px)clamp(20px,5vw,32px);background:linear-gradient(135deg,#3b82f6,#2563eb);color:white;border:none;border-radius:10px;font-family:inherit;font-size:clamp(14px,3.5vw,16px);font-weight:600;cursor:pointer;transition:all 0.2s ease;box-shadow:0 4px 20px rgba(59,130,246,0.35);letter-spacing:0.5px;">üöÄ Iniciar Misi√≥n</button>' + '<button id="skip-briefing" class="mission-btn-secondary" style="padding:clamp(12px,3vw,16px)clamp(16px,4vw,24px);background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.6);border:1px solid rgba(255,255,255,0.15);border-radius:10px;font-family:inherit;font-size:clamp(13px,3vw,14px);font-weight:500;cursor:pointer;transition:all 0.2s ease;">Omitir</button>' + '</div>' + '<div style="text-align:center;margin-top:clamp(16px,4vh,24px);">' + '<label style="font-size:clamp(11px,2.8vw,12px);color:rgba(255,255,255,0.4);cursor:pointer;display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:6px;transition:all 0.2s ease;" onmouseover="this.style.background=\'rgba(255,255,255,0.05)\'" onmouseout="this.style.background=\'transparent\'">' + '<input type="checkbox" id="dont-show-again" style="cursor:pointer;width:16px;height:16px;accent-color:#3b82f6;">' + '<span>No volver a mostrar</span>' + '</label>' + '</div>';this.overlay.appendChild(content);document.body.appendChild(this.overlay);var style = document.createElement('style');style.textContent = '@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}' + '@keyframes slideUp{from{transform:translateY(40px)scale(0.95);opacity:0;}to{transform:translateY(0)scale(1);opacity:1;}}' + '@keyframes fadeOut{from{opacity:1;}to{opacity:0;transform:scale(0.95);}}' + '.mission-btn-primary:hover{transform:translateY(-2px)scale(1.02);box-shadow:0 6px 25px rgba(59,130,246,0.5)!important;}' + '.mission-btn-primary:active{transform:translateY(0)scale(0.98);}' + '.mission-btn-secondary:hover{background:rgba(255,255,255,0.1)!important;color:rgba(255,255,255,0.9)!important;border-color:rgba(255,255,255,0.3)!important;}' + '.mission-btn-secondary:active{transform:scale(0.95);}' + '@media(max-width:600px){#mission-briefing > div{max-height:90vh;overflow-y:auto;}}';document.head.appendChild(style);document.getElementById('start-mission').addEventListener('click',function(){self.close(true);});document.getElementById('skip-briefing').addEventListener('click',function(){self.close(false);});};MissionBriefing.prototype.close = function(playSound){var dontShow = document.getElementById('dont-show-again');if(dontShow && dontShow.checked){localStorage.setItem('missionBriefingShown','true');}var self = this;if(this.overlay){this.overlay.style.animation = 'fadeOut 0.25s ease-out';setTimeout(function(){if(self.overlay && self.overlay.parentNode){self.overlay.parentNode.removeChild(self.overlay);}self.overlay = null;},250);}};MissionBriefing.reset = function(){localStorage.removeItem('missionBriefingShown');console.log('Mission briefing reset. Reload page to see it again.');};function KeyboardInputManager(){this.events ={};this.isProcessingMove = false;this.moveDelay = 100;this.lastMoveTime = 0;if(window.navigator.msPointerEnabled){this.eventTouchstart = "MSPointerDown";this.eventTouchmove = "MSPointerMove";this.eventTouchend = "MSPointerUp";}else{this.eventTouchstart = "touchstart";this.eventTouchmove = "touchmove";this.eventTouchend = "touchend";}this.listen();}KeyboardInputManager.prototype.on = function(event,callback){if(!this.events[event]){this.events[event] = [];}this.events[event].push(callback);};KeyboardInputManager.prototype.emit = function(event,data){var callbacks = this.events[event];if(callbacks){callbacks.forEach(function(callback){callback(data);});}};KeyboardInputManager.prototype.listen = function(){var self = this;var map ={38:0,39:1,40:2,37:3,75:0,76:1,74:2,72:3,87:0,68:1,83:2,65:3};document.addEventListener("keydown",function(event){var modifiers = event.altKey || event.ctrlKey || event.metaKey || event.shiftKey;var mapped = map[event.which];if(!modifiers){if(mapped !== undefined){event.preventDefault();var now = Date.now();if(now - self.lastMoveTime >= self.moveDelay && !self.isProcessingMove){self.lastMoveTime = now;self.isProcessingMove = true;self.emit("move",mapped);setTimeout(function(){self.isProcessingMove = false;},50);}}}if(!modifiers && event.which === 82){self.restart.call(self,event);}if(event.altKey && event.shiftKey && !event.ctrlKey){if(event.which === 86){event.preventDefault();self.emit("debugWin");console.log('üéÆ DEBUG:Auto-win triggered(Alt+Shift+V)');}else if(event.which === 88){event.preventDefault();self.emit("debugLose");console.log('üéÆ DEBUG:Auto-lose triggered(Alt+Shift+X)');}}});this.bindButtonPress(".retry-button",this.restart);this.bindButtonPress(".restart-button",this.restart);this.bindButtonPress(".keep-playing-button",this.keepPlaying);var touchStartClientX,touchStartClientY;var gameContainer = document.getElementsByClassName("game-container")[0];gameContainer.addEventListener(this.eventTouchstart,function(event){if((!window.navigator.msPointerEnabled && event.touches.length > 1)|| event.targetTouches.length > 1){return;}if(window.navigator.msPointerEnabled){touchStartClientX = event.pageX;touchStartClientY = event.pageY;}else{touchStartClientX = event.touches[0].clientX;touchStartClientY = event.touches[0].clientY;}event.preventDefault();});gameContainer.addEventListener(this.eventTouchmove,function(event){event.preventDefault();});gameContainer.addEventListener(this.eventTouchend,function(event){if((!window.navigator.msPointerEnabled && event.touches.length > 0)|| event.targetTouches.length > 0){return;}var touchEndClientX,touchEndClientY;if(window.navigator.msPointerEnabled){touchEndClientX = event.pageX;touchEndClientY = event.pageY;}else{touchEndClientX = event.changedTouches[0].clientX;touchEndClientY = event.changedTouches[0].clientY;}var dx = touchEndClientX - touchStartClientX;var absDx = Math.abs(dx);var dy = touchEndClientY - touchStartClientY;var absDy = Math.abs(dy);if(Math.max(absDx,absDy)> 10){var now = Date.now();if(now - self.lastMoveTime >= self.moveDelay && !self.isProcessingMove){self.lastMoveTime = now;self.isProcessingMove = true;self.emit("move",absDx > absDy ?(dx > 0 ? 1:3):(dy > 0 ? 2:0));setTimeout(function(){self.isProcessingMove = false;},50);}}});};KeyboardInputManager.prototype.restart = function(event){event.preventDefault();this.emit("restart");};KeyboardInputManager.prototype.keepPlaying = function(event){event.preventDefault();this.emit("keepPlaying");};KeyboardInputManager.prototype.bindButtonPress = function(selector,fn){var button = document.querySelector(selector);if(button){button.addEventListener("click",fn.bind(this));button.addEventListener(this.eventTouchend,fn.bind(this));}};function HTMLActuator(){this.tileContainer = document.querySelector(".tile-container");this.scoreContainer = document.querySelector(".score-container");this.bestContainer = document.querySelector(".best-container");this.messageContainer = document.querySelector(".game-message");this.score = 0;}HTMLActuator.prototype.actuate = function(grid,metadata){var self = this;window.requestAnimationFrame(function(){self.clearContainer(self.tileContainer);grid.cells.forEach(function(column){column.forEach(function(cell){if(cell){self.addTile(cell);}});});self.updateScore(metadata.score);self.updateBestScore(metadata.bestScore);if(metadata.terminated){if(metadata.over){self.message(false);}else if(metadata.won){self.message(true);}}});};HTMLActuator.prototype.continueGame = function(){this.clearMessage();};HTMLActuator.prototype.clearContainer = function(container){while(container.firstChild){container.removeChild(container.firstChild);}};HTMLActuator.prototype.addTile = function(tile){var self = this;var wrapper = document.createElement("div");var inner = document.createElement("div");var position = tile.previousPosition ||{x:tile.x,y:tile.y};var positionClass = this.positionClass(position);var classes = ["tile","tile-" + tile.value,positionClass];if(tile.value > 2048)classes.push("tile-super");this.applyClasses(wrapper,classes);inner.classList.add("tile-inner");inner.textContent = tile.value;if(tile.previousPosition){window.requestAnimationFrame(function(){classes[2] = self.positionClass({x:tile.x,y:tile.y});self.applyClasses(wrapper,classes);});}else if(tile.mergedFrom){classes.push("tile-merged");this.applyClasses(wrapper,classes);tile.mergedFrom.forEach(function(merged){self.addTile(merged);});}else{classes.push("tile-new");this.applyClasses(wrapper,classes);}wrapper.appendChild(inner);this.tileContainer.appendChild(wrapper);};HTMLActuator.prototype.applyClasses = function(element,classes){element.setAttribute("class",classes.join(" "));};HTMLActuator.prototype.normalizePosition = function(position){return{x:position.x + 1,y:position.y + 1};};HTMLActuator.prototype.positionClass = function(position){position = this.normalizePosition(position);if(window.responsiveHelper){var pos = window.responsiveHelper.getTilePosition(position.x - 1,position.y - 1);}return "tile-position-" + position.x + "-" + position.y;};HTMLActuator.prototype.updateScore = function(score){this.clearContainer(this.scoreContainer);var difference = score - this.score;this.score = score;this.scoreContainer.textContent = this.score;if(difference > 0){var addition = document.createElement("div");addition.classList.add("score-addition");addition.textContent = "+" + difference;this.scoreContainer.appendChild(addition);}};HTMLActuator.prototype.updateBestScore = function(bestScore){this.bestContainer.textContent = bestScore;};HTMLActuator.prototype.message = function(won){var type = won ? "game-won":"game-over";var message = won ? "üõ∞Ô∏è Reentrada Exitosa!":"üí• Misi√≥n Fallida";this.messageContainer.classList.add(type);var messageElement = this.messageContainer.getElementsByTagName("p")[0];messageElement.textContent = message;if(won){messageElement.innerHTML = message + '<br><span style="font-size:24px;color:#10b981;margin-top:10px;display:block;">Vector 2048 m/s alcanzado</span>';}else{messageElement.innerHTML = message + '<br><span style="font-size:24px;color:#ef4444;margin-top:10px;display:block;">La tripulaci√≥n se perdi√≥</span>';}};HTMLActuator.prototype.clearMessage = function(){this.messageContainer.classList.remove("game-won");this.messageContainer.classList.remove("game-over");};function Grid(size,previousState){this.size = size;this.cells = previousState ? this.fromState(previousState):this.empty();}Grid.prototype.empty = function(){var cells = [];for(var x = 0;x < this.size;x++){var row = cells[x] = [];for(var y = 0;y < this.size;y++){row.push(null);}}return cells;};Grid.prototype.fromState = function(state){var cells = [];for(var x = 0;x < this.size;x++){var row = cells[x] = [];for(var y = 0;y < this.size;y++){var tile = state[x][y];row.push(tile ? new Tile(tile.position,tile.value):null);}}return cells;};Grid.prototype.randomAvailableCell = function(){var cells = this.availableCells();if(cells.length){return cells[Math.floor(Math.random()* cells.length)];}};Grid.prototype.availableCells = function(){var cells = [];this.eachCell(function(x,y,tile){if(!tile){cells.push({x:x,y:y});}});return cells;};Grid.prototype.eachCell = function(callback){for(var x = 0;x < this.size;x++){for(var y = 0;y < this.size;y++){callback(x,y,this.cells[x][y]);}}};Grid.prototype.cellsAvailable = function(){return !!this.availableCells().length;};Grid.prototype.cellAvailable = function(cell){return !this.cellOccupied(cell);};Grid.prototype.cellOccupied = function(cell){return !!this.cellContent(cell);};Grid.prototype.cellContent = function(cell){if(this.withinBounds(cell)){return this.cells[cell.x][cell.y];}else{return null;}};Grid.prototype.insertTile = function(tile){this.cells[tile.x][tile.y] = tile;};Grid.prototype.removeTile = function(tile){this.cells[tile.x][tile.y] = null;};Grid.prototype.withinBounds = function(position){return position.x >= 0 && position.x < this.size && position.y >= 0 && position.y < this.size;};Grid.prototype.serialize = function(){var cellState = [];for(var x = 0;x < this.size;x++){var row = cellState[x] = [];for(var y = 0;y < this.size;y++){row.push(this.cells[x][y] ? this.cells[x][y].serialize():null);}}return{size:this.size,cells:cellState};};function Tile(position,value){this.x = position.x;this.y = position.y;this.value = value || 2;this.previousPosition = null;this.mergedFrom = null;}Tile.prototype.savePosition = function(){this.previousPosition ={x:this.x,y:this.y};};Tile.prototype.updatePosition = function(position){this.x = position.x;this.y = position.y;};Tile.prototype.serialize = function(){return{position:{x:this.x,y:this.y},value:this.value};};window.fakeStorage ={_data:{},setItem:function(id,val){return this._data[id] = String(val);},getItem:function(id){return this._data.hasOwnProperty(id)? this._data[id]:undefined;},removeItem:function(id){return delete this._data[id];},clear:function(){return this._data ={};}};function LocalStorageManager(){this.bestScoreKey = "bestScore";this.gameStateKey = "gameState";var supported = this.localStorageSupported();this.storage = supported ? window.localStorage:window.fakeStorage;}LocalStorageManager.prototype.localStorageSupported = function(){var testKey = "test";try{var storage = window.localStorage;storage.setItem(testKey,"1");storage.removeItem(testKey);return true;}catch(error){return false;}};LocalStorageManager.prototype.getBestScore = function(){return this.storage.getItem(this.bestScoreKey)|| 0;};LocalStorageManager.prototype.setBestScore = function(score){this.storage.setItem(this.bestScoreKey,score);};LocalStorageManager.prototype.getGameState = function(){var stateJSON = this.storage.getItem(this.gameStateKey);if(!stateJSON)return null;try{return JSON.parse(stateJSON);}catch(e){console.warn('Corrupted game state detected,clearing...',e);this.clearGameState();return null;}};LocalStorageManager.prototype.setGameState = function(gameState){try{this.storage.setItem(this.gameStateKey,JSON.stringify(gameState));}catch(e){console.error('Failed to save game state:',e);}};LocalStorageManager.prototype.clearGameState = function(){this.storage.removeItem(this.gameStateKey);};function SoundManager(eventBus){this.audioCtx = null;this.initialized = false;this.masterGain = null;this.droneOsc = null;this.droneLfo = null;this.droneGain = null;this.cleanGain = null;this.distortGain = null;this.eventBus = eventBus;if(this.eventBus){var self = this;this.eventBus.on('game:move',function(data){self.playMove(data.direction);});this.eventBus.on('game:merge',function(data){self.playMerge(data.value);});this.eventBus.on('game:energyUpdate',function(data){self.setDroneEnergy(data.energy);});this.eventBus.on('game:catastrophicFailure',function(){self.playCatastrophicFailure();});this.eventBus.on('game:victoryAchieved',function(){self.playVictory();});this.eventBus.on('oxygen:alert',function(data){self.playOxygenAlert(data.level);});this.eventBus.on('game:milestone',function(data){self.playRadioChatter(data.value);});}}SoundManager.prototype.makeDistortionCurve = function(amount){var k = amount;var n_samples = 44100;var curve = new Float32Array(n_samples);var deg = Math.PI / 180;var x;for(var i = 0;i < n_samples;++i){x = i * 2 / n_samples - 1;curve[i] =(3 + k)* x * 20 * deg /(Math.PI + k * Math.abs(x));}return curve;};SoundManager.prototype.init = function(){if(this.initialized)return;var AudioContext = window.AudioContext || window.webkitAudioContext;if(!AudioContext){console.warn('Web Audio API not supported in this browser');return;}try{this.audioCtx = new AudioContext();}catch(e){console.error('Failed to create AudioContext:',e);return;}this.cleanGain = this.audioCtx.createGain();this.distortGain = this.audioCtx.createGain();this.cleanGain.gain.value = 1.0;this.distortGain.gain.value = 0.0;var distortionNode = this.audioCtx.createWaveShaper();distortionNode.curve = this.makeDistortionCurve(100);distortionNode.oversample = '4x';this.masterGain = this.audioCtx.createGain();this.masterGain.gain.value = 0.6;this.masterGain.connect(this.cleanGain);this.masterGain.connect(distortionNode);distortionNode.connect(this.distortGain);try{this.cleanGain.connect(this.audioCtx.destination);this.distortGain.connect(this.audioCtx.destination);this.startDrone();this.initialized = true;}catch(e){console.error('Failed to initialize audio nodes:',e);this.cleanup();}};SoundManager.prototype.cleanup = function(){try{if(this.droneOsc)this.droneOsc.stop();if(this.droneLfo)this.droneLfo.stop();if(this.audioCtx && this.audioCtx.state !== 'closed'){this.audioCtx.close();}}catch(e){console.error('Error during audio cleanup:',e);}this.initialized = false;this.audioCtx = null;};SoundManager.prototype.startDrone = function(){if(!this.audioCtx)return;try{this.droneOsc = this.audioCtx.createOscillator();this.droneOsc.type = 'sine';this.droneOsc.frequency.value = 55;var droneLfo = this.audioCtx.createOscillator();droneLfo.type = 'sine';droneLfo.frequency.value = 0.2;this.droneLfo = droneLfo;var droneGain = this.audioCtx.createGain();droneGain.gain.value = 0.15;this.droneGain = droneGain;var lfoGain = this.audioCtx.createGain();lfoGain.gain.value = 0.08;droneLfo.connect(lfoGain);lfoGain.connect(droneGain.gain);this.droneOsc.connect(droneGain);droneGain.connect(this.masterGain);this.droneOsc.start();droneLfo.start();}catch(e){console.error('Failed to start drone:',e);}};SoundManager.prototype.setDroneEnergy = function(energy){if(!this.initialized || !this.audioCtx || !this.droneLfo || !this.droneGain || !this.droneOsc)return;try{var cappedEnergy = Math.min(Math.max(energy,0),3.0);var targetLfoFreq;if(cappedEnergy < 0.5){targetLfoFreq = 0.2 +(cappedEnergy * 0.6);}else if(cappedEnergy < 1.5){targetLfoFreq = 0.5 +((cappedEnergy - 0.5)* 1.5);}else{targetLfoFreq = 2.0 +((cappedEnergy - 1.5)* 2.0);}this.droneLfo.frequency.setTargetAtTime(targetLfoFreq,this.audioCtx.currentTime,0.15);var targetGain = 0.12 +(cappedEnergy * 0.12);this.droneGain.gain.setTargetAtTime(targetGain,this.audioCtx.currentTime,0.15);var baseFreq = 55 +(cappedEnergy * 12);this.droneOsc.frequency.setTargetAtTime(baseFreq,this.audioCtx.currentTime,0.15);if(this.cleanGain && this.distortGain){var distortionThreshold = 1.5;if(cappedEnergy > distortionThreshold){var wet = Math.min((cappedEnergy - distortionThreshold)/ 1.5,1);this.distortGain.gain.setTargetAtTime(wet * 0.3,this.audioCtx.currentTime,0.3);this.cleanGain.gain.setTargetAtTime(1.0 -(wet * 0.15),this.audioCtx.currentTime,0.3);}else{this.distortGain.gain.setTargetAtTime(0,this.audioCtx.currentTime,0.3);this.cleanGain.gain.setTargetAtTime(1.0,this.audioCtx.currentTime,0.3);}}}catch(e){console.error('Error setting drone energy:',e);}};SoundManager.prototype.playMove = function(direction){if(!this.initialized || !this.audioCtx)return;try{var osc = this.audioCtx.createOscillator();osc.type = 'sine';var basePitch = 380 +(direction * 35);osc.frequency.setValueAtTime(basePitch,this.audioCtx.currentTime);osc.frequency.exponentialRampToValueAtTime(basePitch * 1.3,this.audioCtx.currentTime + 0.08);var gain = this.audioCtx.createGain();gain.gain.setValueAtTime(0.05,this.audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,this.audioCtx.currentTime + 0.08);osc.connect(gain);gain.connect(this.masterGain);osc.start();osc.stop(this.audioCtx.currentTime + 0.08);}catch(e){console.error('Error playing move sound:',e);}};SoundManager.prototype.playMerge = function(value){if(!this.initialized || !this.audioCtx)return;try{var power = Math.log(value)/ Math.log(2);var baseFreq = 200 * Math.pow(1.059463,(power - 1)* 3);var freqs = [baseFreq];if(value >= 8){freqs.push(baseFreq * 1.5);}if(value >= 16){freqs.push(baseFreq * 1.25);}if(value >= 64){freqs.push(baseFreq * 2);}if(value >= 256){freqs.push(baseFreq * 0.5);}if(value >= 512){freqs.push(baseFreq * 3);}if(value >= 1024){freqs.push(baseFreq * 4);freqs.push(baseFreq * 1.5 * 2);}var self = this;freqs.forEach(function(f,i){try{var osc = self.audioCtx.createOscillator();if(value >= 1024){osc.type =(i % 2 === 0)? 'sawtooth':'square';}else if(value >= 256){osc.type = 'sawtooth';}else if(value >= 64){osc.type = 'triangle';}else{osc.type = 'sine';}osc.frequency.setValueAtTime(f +(i*2),self.audioCtx.currentTime);var gain = self.audioCtx.createGain();gain.gain.setValueAtTime(0,self.audioCtx.currentTime);var peakGain = 0.08 / freqs.length;if(value >= 256)peakGain *= 1.3;gain.gain.linearRampToValueAtTime(peakGain,self.audioCtx.currentTime + 0.04);var decayTime = 0.25;if(value >= 32)decayTime = 0.4;if(value >= 128)decayTime = 0.6;if(value >= 512)decayTime = 1.0;if(value >= 1024)decayTime = 1.4;gain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + decayTime);var filter = self.audioCtx.createBiquadFilter();filter.type = 'lowpass';var filterFreq = 800 +(power * 250);if(value >= 256)filterFreq += 800;if(value >= 512)filterFreq += 1000;filter.frequency.setValueAtTime(Math.min(filterFreq,5000),self.audioCtx.currentTime);if(value >= 512){filter.Q.setValueAtTime(2 +(power * 0.3),self.audioCtx.currentTime);}osc.connect(filter);filter.connect(gain);gain.connect(self.masterGain);osc.start();osc.stop(self.audioCtx.currentTime + decayTime + 0.1);}catch(e){console.error('Error creating merge oscillator:',e);}});}catch(e){console.error('Error playing merge sound:',e);}};SoundManager.prototype.playCatastrophicFailure = function(){if(!this.initialized || !this.audioCtx)return;try{var self = this;if(this.droneOsc){this.droneOsc.frequency.exponentialRampToValueAtTime(20,this.audioCtx.currentTime + 0.5);this.droneGain.gain.exponentialRampToValueAtTime(0.001,this.audioCtx.currentTime + 0.5);}var bass = this.audioCtx.createOscillator();bass.type = 'sawtooth';bass.frequency.setValueAtTime(40,this.audioCtx.currentTime);bass.frequency.exponentialRampToValueAtTime(20,this.audioCtx.currentTime + 2);var bassGain = this.audioCtx.createGain();bassGain.gain.setValueAtTime(0,this.audioCtx.currentTime);bassGain.gain.linearRampToValueAtTime(0.3,this.audioCtx.currentTime + 0.1);bassGain.gain.exponentialRampToValueAtTime(0.001,this.audioCtx.currentTime + 3);bass.connect(bassGain);bassGain.connect(this.masterGain);bass.start();bass.stop(this.audioCtx.currentTime + 3);for(var i = 0;i < 8;i++){(function(index){setTimeout(function(){var chaos = self.audioCtx.createOscillator();chaos.type = 'square';var freq = 100 + Math.random()* 400;chaos.frequency.setValueAtTime(freq,self.audioCtx.currentTime);chaos.frequency.exponentialRampToValueAtTime(freq * 0.3,self.audioCtx.currentTime + 0.5);var chaosGain = self.audioCtx.createGain();chaosGain.gain.setValueAtTime(0.15,self.audioCtx.currentTime);chaosGain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 0.5);chaos.connect(chaosGain);chaosGain.connect(self.masterGain);chaos.start();chaos.stop(self.audioCtx.currentTime + 0.5);},index * 120);})(i);}for(var j = 0;j < 15;j++){(function(index){setTimeout(function(){var debris = self.audioCtx.createOscillator();debris.type = Math.random()> 0.5 ? 'sawtooth':'square';var freq = 800 + Math.random()* 2000;debris.frequency.setValueAtTime(freq,self.audioCtx.currentTime);debris.frequency.exponentialRampToValueAtTime(freq * 2,self.audioCtx.currentTime + 0.1);var debrisGain = self.audioCtx.createGain();debrisGain.gain.setValueAtTime(0.08,self.audioCtx.currentTime);debrisGain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 0.15);var filter = self.audioCtx.createBiquadFilter();filter.type = 'highpass';filter.frequency.setValueAtTime(1000,self.audioCtx.currentTime);debris.connect(filter);filter.connect(debrisGain);debrisGain.connect(self.masterGain);debris.start();debris.stop(self.audioCtx.currentTime + 0.15);},index * 80 + Math.random()* 50);})(j);}var bufferSize = this.audioCtx.sampleRate * 2;var noiseBuffer = this.audioCtx.createBuffer(1,bufferSize,this.audioCtx.sampleRate);var output = noiseBuffer.getChannelData(0);for(var k = 0;k < bufferSize;k++){output[k] = Math.random()* 2 - 1;}var whiteNoise = this.audioCtx.createBufferSource();whiteNoise.buffer = noiseBuffer;var noiseGain = this.audioCtx.createGain();noiseGain.gain.setValueAtTime(0,this.audioCtx.currentTime);noiseGain.gain.linearRampToValueAtTime(0.2,this.audioCtx.currentTime + 0.05);noiseGain.gain.exponentialRampToValueAtTime(0.001,this.audioCtx.currentTime + 1.5);var noiseFilter = this.audioCtx.createBiquadFilter();noiseFilter.type = 'bandpass';noiseFilter.frequency.setValueAtTime(500,this.audioCtx.currentTime);noiseFilter.frequency.exponentialRampToValueAtTime(100,this.audioCtx.currentTime + 1.5);noiseFilter.Q.setValueAtTime(0.5,this.audioCtx.currentTime);whiteNoise.connect(noiseFilter);noiseFilter.connect(noiseGain);noiseGain.connect(this.masterGain);whiteNoise.start();whiteNoise.stop(this.audioCtx.currentTime + 1.5);var alarm = this.audioCtx.createOscillator();alarm.type = 'sine';alarm.frequency.setValueAtTime(1200,this.audioCtx.currentTime + 0.3);alarm.frequency.exponentialRampToValueAtTime(200,this.audioCtx.currentTime + 2.5);var alarmGain = this.audioCtx.createGain();alarmGain.gain.setValueAtTime(0,this.audioCtx.currentTime + 0.3);alarmGain.gain.linearRampToValueAtTime(0.12,this.audioCtx.currentTime + 0.4);alarmGain.gain.exponentialRampToValueAtTime(0.001,this.audioCtx.currentTime + 2.5);alarm.connect(alarmGain);alarmGain.connect(this.masterGain);alarm.start(this.audioCtx.currentTime + 0.3);alarm.stop(this.audioCtx.currentTime + 2.5);}catch(e){console.error('Error playing catastrophic failure sound:',e);}};SoundManager.prototype.playVictory = function(){if(!this.initialized || !this.audioCtx)return;try{var self = this;if(this.droneOsc && this.droneGain){this.droneGain.gain.exponentialRampToValueAtTime(0.001,this.audioCtx.currentTime + 2);}var rootFreq = 261.63;var chord = [ rootFreq,rootFreq * 1.25,rootFreq * 1.5,rootFreq * 2 ];chord.forEach(function(freq,index){var osc = self.audioCtx.createOscillator();osc.type = 'sine';osc.frequency.setValueAtTime(freq,self.audioCtx.currentTime);var gain = self.audioCtx.createGain();gain.gain.setValueAtTime(0,self.audioCtx.currentTime);gain.gain.linearRampToValueAtTime(0.15 / chord.length,self.audioCtx.currentTime + 0.1);gain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 2.5);osc.connect(gain);gain.connect(self.masterGain);osc.start();osc.stop(self.audioCtx.currentTime + 2.5);});var arpeggio = [rootFreq,rootFreq * 1.25,rootFreq * 1.5,rootFreq * 2,rootFreq * 2.5];arpeggio.forEach(function(freq,index){setTimeout(function(){var osc = self.audioCtx.createOscillator();osc.type = 'triangle';osc.frequency.setValueAtTime(freq,self.audioCtx.currentTime);var gain = self.audioCtx.createGain();gain.gain.setValueAtTime(0.12,self.audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 0.6);osc.connect(gain);gain.connect(self.masterGain);osc.start();osc.stop(self.audioCtx.currentTime + 0.6);},index * 100);});setTimeout(function(){var bufferSize = self.audioCtx.sampleRate * 1;var noiseBuffer = self.audioCtx.createBuffer(1,bufferSize,self.audioCtx.sampleRate);var output = noiseBuffer.getChannelData(0);for(var i = 0;i < bufferSize;i++){output[i] = Math.random()* 2 - 1;}var splash = self.audioCtx.createBufferSource();splash.buffer = noiseBuffer;var splashGain = self.audioCtx.createGain();splashGain.gain.setValueAtTime(0,self.audioCtx.currentTime);splashGain.gain.linearRampToValueAtTime(0.08,self.audioCtx.currentTime + 0.05);splashGain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 0.8);var splashFilter = self.audioCtx.createBiquadFilter();splashFilter.type = 'bandpass';splashFilter.frequency.setValueAtTime(2000,self.audioCtx.currentTime);splashFilter.frequency.exponentialRampToValueAtTime(400,self.audioCtx.currentTime + 0.8);splashFilter.Q.setValueAtTime(3,self.audioCtx.currentTime);splash.connect(splashFilter);splashFilter.connect(splashGain);splashGain.connect(self.masterGain);splash.start();splash.stop(self.audioCtx.currentTime + 0.8);},200);setTimeout(function(){var bellFreqs = [523.25,659.25,783.99];bellFreqs.forEach(function(freq,index){setTimeout(function(){var bell = self.audioCtx.createOscillator();bell.type = 'sine';bell.frequency.setValueAtTime(freq,self.audioCtx.currentTime);var bellGain = self.audioCtx.createGain();bellGain.gain.setValueAtTime(0.1,self.audioCtx.currentTime);bellGain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 1.5);var tremolo = self.audioCtx.createOscillator();tremolo.type = 'sine';tremolo.frequency.setValueAtTime(5,self.audioCtx.currentTime);var tremoloGain = self.audioCtx.createGain();tremoloGain.gain.setValueAtTime(0.02,self.audioCtx.currentTime);tremolo.connect(tremoloGain);tremoloGain.connect(bellGain.gain);bell.connect(bellGain);bellGain.connect(self.masterGain);bell.start();tremolo.start();bell.stop(self.audioCtx.currentTime + 1.5);tremolo.stop(self.audioCtx.currentTime + 1.5);},index * 150);});},800);}catch(e){console.error('Error playing victory sound:',e);}};SoundManager.prototype.playOxygenAlert = function(level){if(!this.initialized || !this.audioCtx)return;try{var self = this;if(level === 0){for(var i = 0;i < 3;i++){(function(index){setTimeout(function(){var osc = self.audioCtx.createOscillator();osc.type = 'sine';osc.frequency.setValueAtTime(880,self.audioCtx.currentTime);var gain = self.audioCtx.createGain();gain.gain.setValueAtTime(0.15,self.audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 0.12);osc.connect(gain);gain.connect(self.masterGain);osc.start();osc.stop(self.audioCtx.currentTime + 0.12);},index * 150);})(i);}}else if(level === 1){for(var j = 0;j < 2;j++){(function(index){setTimeout(function(){var osc = self.audioCtx.createOscillator();osc.type = 'sine';osc.frequency.setValueAtTime(660,self.audioCtx.currentTime);osc.frequency.exponentialRampToValueAtTime(440,self.audioCtx.currentTime + 0.2);var gain = self.audioCtx.createGain();gain.gain.setValueAtTime(0.1,self.audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 0.25);osc.connect(gain);gain.connect(self.masterGain);osc.start();osc.stop(self.audioCtx.currentTime + 0.25);},index * 300);})(j);}}else{var osc = this.audioCtx.createOscillator();osc.type = 'sine';osc.frequency.setValueAtTime(440,this.audioCtx.currentTime);var gain = this.audioCtx.createGain();gain.gain.setValueAtTime(0.06,this.audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,this.audioCtx.currentTime + 0.3);osc.connect(gain);gain.connect(this.masterGain);osc.start();osc.stop(this.audioCtx.currentTime + 0.3);}}catch(e){console.error('Error playing oxygen alert:',e);}};SoundManager.prototype.playRadioChatter = function(value){if(!this.initialized || !this.audioCtx)return;try{var self = this;var bufferSize = this.audioCtx.sampleRate * 0.3;var noiseBuffer = this.audioCtx.createBuffer(1,bufferSize,this.audioCtx.sampleRate);var output = noiseBuffer.getChannelData(0);for(var i = 0;i < bufferSize;i++){output[i] = Math.random()* 2 - 1;}var staticNoise = this.audioCtx.createBufferSource();staticNoise.buffer = noiseBuffer;var staticGain = this.audioCtx.createGain();staticGain.gain.setValueAtTime(0,this.audioCtx.currentTime);staticGain.gain.linearRampToValueAtTime(0.06,this.audioCtx.currentTime + 0.02);staticGain.gain.linearRampToValueAtTime(0.02,this.audioCtx.currentTime + 0.08);staticGain.gain.exponentialRampToValueAtTime(0.001,this.audioCtx.currentTime + 0.3);var radioFilter = this.audioCtx.createBiquadFilter();radioFilter.type = 'bandpass';radioFilter.frequency.setValueAtTime(1500,this.audioCtx.currentTime);radioFilter.Q.setValueAtTime(5,this.audioCtx.currentTime);staticNoise.connect(radioFilter);radioFilter.connect(staticGain);staticGain.connect(this.masterGain);staticNoise.start();staticNoise.stop(this.audioCtx.currentTime + 0.3);setTimeout(function(){var tones;if(value >= 512){tones = [600,750,900];}else if(value >= 128){tones = [550,700];}else{tones = [600];}tones.forEach(function(freq,index){setTimeout(function(){var osc = self.audioCtx.createOscillator();osc.type = 'sine';osc.frequency.setValueAtTime(freq,self.audioCtx.currentTime);var gain = self.audioCtx.createGain();gain.gain.setValueAtTime(0.08,self.audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,self.audioCtx.currentTime + 0.15);var filter = self.audioCtx.createBiquadFilter();filter.type = 'bandpass';filter.frequency.setValueAtTime(freq,self.audioCtx.currentTime);filter.Q.setValueAtTime(3,self.audioCtx.currentTime);osc.connect(filter);filter.connect(gain);gain.connect(self.masterGain);osc.start();osc.stop(self.audioCtx.currentTime + 0.15);},index * 100);});},200);}catch(e){console.error('Error playing radio chatter:',e);}};function VisualEffectsManager(eventBus){this.canvas = document.getElementById('bg-canvas');if(!this.canvas)return;this.ctx = this.canvas.getContext('2d');this.particles = [];this.maxParticles = 300;this.baseParticles = 150;this.width = window.innerWidth;this.height = window.innerHeight;this.flashIntensity = 0;this.baseColor ={r:5,g:15,b:35};this.targetVectors ={x:0,y:0};this.colorPhases ={space:{r:5,g:15,b:35},thermosphere:{r:25,g:35,b:65},mesosphere:{r:45,g:45,b:75},stratosphere:{r:85,g:50,b:45},ionization:{r:145,g:65,b:25},reentry:{r:180,g:45,b:15}};this.energy = 0;this.progressFactor = 0.0;this.breathingPhase = 0;this.gameOverShake = false;this.radarPhase = 0;this.radarRings = [];this.heatDistortion = 0;this.milestoneFlash = 0;this.staticNoiseTimer = 0;this.staticIntensity = 0;this.difficultyConfig ={earlyGameCap:0.15,midGameCap:0.40,lateGameStart:512,exponentialPower:2.5};this.eventBus = eventBus;this.gameContainer = document.querySelector('.game-container');this.resize();window.addEventListener('resize',this.resize.bind(this));for(var i=0;i<this.baseParticles;i++){this.particles.push(this.createParticle());}if(this.eventBus){var self = this;this.eventBus.on('game:move',function(data){self.triggerMove(data.direction);});this.eventBus.on('game:merge',function(data){self.triggerMerge(data.value);});this.eventBus.on('game:over',function(){self.triggerGameOver();});this.eventBus.on('game:won',function(){self.triggerVictory();});this.eventBus.on('game:milestone',function(data){self.triggerMilestone(data.value);});}this.boundLoop = this.loop.bind(this);this.boundLoop();}VisualEffectsManager.prototype.setGameProgress = function(maxTileValue,tileSum){var sumCapped = Math.min(tileSum || 4,4000);var normalizedSum = sumCapped / 4000;var progress = Math.pow(normalizedSum,this.difficultyConfig.exponentialPower);if(sumCapped < 200){this.progressFactor = Math.min(progress,this.difficultyConfig.earlyGameCap);}else if(sumCapped < 1000){var blend =(sumCapped - 200)/ 800;var target = this.difficultyConfig.earlyGameCap +(this.difficultyConfig.midGameCap - this.difficultyConfig.earlyGameCap)* blend;this.progressFactor = Math.min(progress,target);}else{this.progressFactor = progress;}if(maxTileValue >= 512){var tileBoost =(Math.log(maxTileValue)/ Math.log(2)- 8)* 0.08;this.progressFactor = Math.min(1.0,this.progressFactor + tileBoost);}var phase = this.colorPhases;var p = this.progressFactor;if(p < 0.1){var t = p / 0.1;this.baseColor ={r:Math.floor(phase.space.r +(phase.thermosphere.r - phase.space.r)* t),g:Math.floor(phase.space.g +(phase.thermosphere.g - phase.space.g)* t),b:Math.floor(phase.space.b +(phase.thermosphere.b - phase.space.b)* t)};}else if(p < 0.25){var t =(p - 0.1)/ 0.15;this.baseColor ={r:Math.floor(phase.thermosphere.r +(phase.mesosphere.r - phase.thermosphere.r)* t),g:Math.floor(phase.thermosphere.g +(phase.mesosphere.g - phase.thermosphere.g)* t),b:Math.floor(phase.thermosphere.b +(phase.mesosphere.b - phase.thermosphere.b)* t)};}else if(p < 0.5){var t =(p - 0.25)/ 0.25;this.baseColor ={r:Math.floor(phase.mesosphere.r +(phase.stratosphere.r - phase.mesosphere.r)* t),g:Math.floor(phase.mesosphere.g +(phase.stratosphere.g - phase.mesosphere.g)* t),b:Math.floor(phase.mesosphere.b +(phase.stratosphere.b - phase.mesosphere.b)* t)};}else if(p < 0.75){var t =(p - 0.5)/ 0.25;this.baseColor ={r:Math.floor(phase.stratosphere.r +(phase.ionization.r - phase.stratosphere.r)* t),g:Math.floor(phase.stratosphere.g +(phase.ionization.g - phase.stratosphere.g)* t),b:Math.floor(phase.stratosphere.b +(phase.ionization.b - phase.stratosphere.b)* t)};}else{var t =(p - 0.75)/ 0.25;this.baseColor ={r:Math.floor(phase.ionization.r +(phase.reentry.r - phase.ionization.r)* t),g:Math.floor(phase.ionization.g +(phase.reentry.g - phase.ionization.g)* t),b:Math.floor(phase.ionization.b +(phase.reentry.b - phase.ionization.b)* t)};}};VisualEffectsManager.prototype.createParticle = function(x,y){var hue;if(this.progressFactor < 0.2){hue = Math.floor(Math.random()* 40)+ 200;}else if(this.progressFactor < 0.4){hue = Math.floor(Math.random()* 40)+ 220;}else if(this.progressFactor < 0.65){hue = Math.floor(Math.random()* 30)+ 20;}else{hue = Math.floor(Math.random()* 20)+ 0;}return{x:x !== undefined ? x:Math.random()* this.width,y:y !== undefined ? y:Math.random()* this.height,size:Math.random()* 2.5 + 0.5,vx:(Math.random()- 0.5)* 0.8,vy:(Math.random()- 0.5)* 0.8,life:Math.random()* 50,maxLife:200 + Math.random()* 300,alphaBase:Math.random()* 0.4 + 0.1,hue:hue};};VisualEffectsManager.prototype.resize = function(){this.width = window.innerWidth;this.height = window.innerHeight;this.canvas.width = this.width;this.canvas.height = this.height;};VisualEffectsManager.prototype.triggerMove = function(direction){var baseForce = 2;var scaledForce = 10 * this.progressFactor;var force = baseForce + scaledForce;if(direction === 0){this.targetVectors.x = 0;this.targetVectors.y = -force;}if(direction === 1){this.targetVectors.x = force;this.targetVectors.y = 0;}if(direction === 2){this.targetVectors.x = 0;this.targetVectors.y = force;}if(direction === 3){this.targetVectors.x = -force;this.targetVectors.y = 0;}var baseFlash = 0.02;var scaledFlash = 0.12 * this.progressFactor;this.flashIntensity = Math.max(this.flashIntensity,baseFlash + scaledFlash);var baseEnergyAdd = 0.05;var scaledEnergyAdd = 0.25 * this.progressFactor;var energyAdd = baseEnergyAdd + scaledEnergyAdd;var maxEnergy = 0.8 +(this.progressFactor * 2.2);this.energy = Math.min(this.energy + energyAdd,maxEnergy);};VisualEffectsManager.prototype.triggerMilestone = function(value){var self = this;this.milestoneFlash = 0.3 +(Math.log(value)/ Math.log(2))* 0.05;var numParticles = Math.min(20,10 + Math.floor(value / 64));var availableSlots = this.maxParticles - this.particles.length;numParticles = Math.min(numParticles,availableSlots);for(var i = 0;i < numParticles;i++){var angle =(i / numParticles)* Math.PI * 2;var p = this.createParticle(this.width / 2,this.height / 2);var speed = 3 +(value / 256)* 4;p.vx = Math.cos(angle)* speed;p.vy = Math.sin(angle)* speed;p.size = 2 +(value / 512)* 3;p.alphaBase = 0.6;p.maxLife = 80 + Math.random()* 60;if(value >= 512){p.hue = Math.random()* 15 + 5;}else if(value >= 128){p.hue = Math.random()* 30 + 260;}else{p.hue = Math.random()* 30 + 210;}this.particles.push(p);}if(value >= 256){this.heatDistortion = Math.min(1,(value / 2048)* 1.5);}};VisualEffectsManager.prototype.triggerVictory = function(){var self = this;this.flashIntensity = 0.8;this.energy = 0.3;this.baseColor ={r:20,g:100,b:180};var transitionSteps = 60;var currentStep = 0;var transitionInterval = setInterval(function(){currentStep++;var progress = currentStep / transitionSteps;self.baseColor.r = Math.floor(20 +(135 * progress));self.baseColor.g = Math.floor(100 +(105 * progress));self.baseColor.b = Math.floor(180 +(35 * progress));if(currentStep >= transitionSteps){clearInterval(transitionInterval);}},16);var celebrationWaves = 3;var particlesPerWave = 50;for(var wave = 0;wave < celebrationWaves;wave++){setTimeout(function(waveIndex){var availableSlots = self.maxParticles - self.particles.length;var particlesToAdd = Math.min(particlesPerWave,availableSlots);for(var i = 0;i < particlesToAdd;i++){var p = self.createParticle(self.width / 2,self.height / 2);var angle = Math.random()* Math.PI * 2;var speed =(Math.random()* 8 + 3)*(1 - waveIndex * 0.2);p.vx = Math.cos(angle)* speed;p.vy = Math.sin(angle)* speed -(Math.random()* 3 + 2);p.size = Math.random()* 6 + 2;p.alphaBase = 0.7;var colorChoice = Math.random();if(colorChoice < 0.4){p.hue = Math.random()* 20 + 180;}else if(colorChoice < 0.7){p.hue = Math.random()* 20 + 200;}else{p.hue = Math.random()* 20 + 50;}p.maxLife = 120 + Math.random()* 180;self.particles.push(p);}},wave * 200,wave);}setTimeout(function(){for(var i = 0;i < 30;i++){var p = self.createParticle(Math.random()* self.width,self.height * 0.7 + Math.random()* self.height * 0.3);p.vx =(Math.random()- 0.5)* 2;p.vy = -(Math.random()* 2 + 1);p.size = Math.random()* 4 + 1;p.alphaBase = 0.4;p.hue = Math.random()* 30 + 190;p.maxLife = 200 + Math.random()* 300;self.particles.push(p);}},600);this.gameOverShake = false;if(self.eventBus){self.eventBus.emit('game:victoryAchieved');}};VisualEffectsManager.prototype.triggerGameOver = function(){var self = this;this.gameOverTime = Date.now();this.flashIntensity = 3.0;this.energy = 5.0;this.baseColor ={r:255,g:80,b:0};var explosionWaves = 5;var particlesPerWave = 80;for(var wave = 0;wave < explosionWaves;wave++){setTimeout(function(waveIndex){var availableSlots = self.maxParticles - self.particles.length;var particlesToAdd = Math.min(particlesPerWave,availableSlots);for(var i = 0;i < particlesToAdd;i++){var p = self.createParticle(self.width / 2,self.height / 2);var angle = Math.random()* Math.PI * 2;var speed =(Math.random()* 20 + 10)*(1 + waveIndex * 0.3);p.vx = Math.cos(angle)* speed;p.vy = Math.sin(angle)* speed;p.size = Math.random()* 15 + 3;p.alphaBase = 1.0;var colorChoice = Math.random();if(colorChoice < 0.3){p.hue = Math.random()* 20;}else if(colorChoice < 0.6){p.hue = Math.random()* 20 + 20;}else if(colorChoice < 0.85){p.hue = Math.random()* 20 + 40;}else{p.hue = 0;p.alphaBase = 1.5;}p.maxLife = 150 + Math.random()* 200;self.particles.push(p);}},wave * 150,wave);}this.gameOverShake = true;if(self.eventBus){self.eventBus.emit('game:catastrophicFailure');}};VisualEffectsManager.prototype.triggerMerge = function(value){var valCapped = Math.min(value,2048);var normalizedVal = Math.max((Math.log(valCapped)/ Math.log(2))/ 11,0.1);var baseFlash = 0.1 +(normalizedVal * 0.2);var progressBonus = this.progressFactor * 0.3;var flashAdd = baseFlash *(1 + progressBonus);this.flashIntensity = Math.min(this.flashIntensity + flashAdd,0.8 +(this.progressFactor * 0.6));var baseEnergyAdd = 0.15 +(normalizedVal * 0.25);var energyAdd = baseEnergyAdd *(1 +(this.progressFactor * 0.7));var maxEnergy = 0.8 +(this.progressFactor * 2.2);this.energy = Math.min(this.energy + energyAdd,maxEnergy);var baseParticles = 8;var scaledParticles = Math.floor(12 * normalizedVal *(0.5 + this.progressFactor * 0.5));var numExplosionParticles = baseParticles + scaledParticles;if(value >= 512 && this.progressFactor > 0.6){numExplosionParticles *= 1.5;}var particlesToAdd = Math.min(numExplosionParticles,this.maxParticles - this.particles.length);for(var i=0;i<particlesToAdd;i++){var p = this.createParticle(this.width/2,this.height/2);var angle = Math.random()* Math.PI * 2;var speed =(Math.random()* 12 + 4)* normalizedVal *(1 + this.progressFactor);p.vx = Math.cos(angle)* speed;p.vy = Math.sin(angle)* speed;p.size = Math.random()* 8 * normalizedVal + 2;p.alphaBase = 0.8;if(value >= 512){p.hue = Math.random()* 20 + 0;}else if(value >= 256){p.hue = Math.random()* 30 + 20;}else if(value >= 128){p.hue = Math.random()* 40 + 200;}else{p.hue = Math.random()* 50 + 190;}this.particles.push(p);}};VisualEffectsManager.prototype.loop = function(){window.requestAnimationFrame(this.boundLoop);var bgAlpha = 0.3;var currentBgR = Math.floor(this.baseColor.r +(255 - this.baseColor.r)* this.flashIntensity * 0.5);var currentBgG = Math.floor(this.baseColor.g +(255 - this.baseColor.g)* this.flashIntensity * 0.7);var currentBgB = Math.floor(this.baseColor.b +(255 - this.baseColor.b)* this.flashIntensity);this.ctx.fillStyle = 'rgba(' + currentBgR + ',' + currentBgG + ',' + currentBgB + ',' + bgAlpha + ')';this.ctx.fillRect(0,0,this.width,this.height);this.flashIntensity *= 0.90;this.milestoneFlash *= 0.92;this.heatDistortion *= 0.995;this.targetVectors.x *= 0.92;this.targetVectors.y *= 0.92;if(this.milestoneFlash > 0.01){this.ctx.fillStyle = 'rgba(255,255,255,' +(this.milestoneFlash * 0.15)+ ')';this.ctx.fillRect(0,0,this.width,this.height);}if(this.heatDistortion > 0.05 && this.progressFactor > 0.3){var heatAlpha = this.heatDistortion * 0.08;var waveTime = Date.now()* 0.003;for(var h = 0;h < this.height;h += 12){var offset = Math.sin(waveTime + h * 0.05)* this.heatDistortion * 3;this.ctx.fillStyle = 'rgba(255,120,50,' +(heatAlpha *(0.5 + Math.sin(h * 0.1 + waveTime)* 0.5))+ ')';this.ctx.fillRect(offset,h,this.width,1);}}this.energy = Math.max(0,this.energy - 0.002);this.radarPhase += 0.015 +(this.progressFactor * 0.03);if(Math.sin(this.radarPhase)> 0.98 && this.radarRings.length < 3){this.radarRings.push({radius:0,alpha:0.4 +(this.progressFactor * 0.3),maxRadius:Math.max(this.width,this.height)* 0.7});}this.staticNoiseTimer += 0.01 +(this.progressFactor * 0.02);if(this.staticIntensity > 0){this.staticIntensity *= 0.9;if(this.staticIntensity > 0.02){for(var s = 0;s < this.height;s += 4){if(Math.random()< this.staticIntensity * 0.5){var noiseAlpha = Math.random()* this.staticIntensity * 0.15;this.ctx.fillStyle = 'rgba(180,220,255,' + noiseAlpha + ')';this.ctx.fillRect(0,s,this.width,1);}}}}if(Math.sin(this.staticNoiseTimer)> 0.995 && this.progressFactor > 0.15){this.staticIntensity = 0.3 +(this.progressFactor * 0.5);}for(var r = this.radarRings.length - 1;r >= 0;r--){var ring = this.radarRings[r];ring.radius += 3 +(this.progressFactor * 4);ring.alpha *= 0.98;if(ring.alpha < 0.01 || ring.radius > ring.maxRadius){this.radarRings.splice(r,1);continue;}this.ctx.beginPath();this.ctx.arc(this.width / 2,this.height / 2,ring.radius,0,Math.PI * 2);this.ctx.strokeStyle = 'hsla(' +(200 -(this.progressFactor * 180))+ ',80%,60%,' + ring.alpha + ')';this.ctx.lineWidth = 1.5 +(this.progressFactor * 1.5);this.ctx.stroke();}if(this.eventBus){this.eventBus.emit('game:energyUpdate',{energy:this.energy});}if(this.gameContainer){var breathingFreq = 0.01 +(this.energy * 0.05);this.breathingPhase += breathingFreq;var amplitude = 0.001 +(this.energy * 0.010);var scale = 1.0 + Math.sin(this.breathingPhase)* amplitude;var rotateAmplitude = this.energy * 0.2;var rotate = Math.cos(this.breathingPhase * 0.5)* rotateAmplitude;var shakeX = 0;var shakeY = 0;if(this.gameOverShake){var baseShake = 15;var decay = Math.max(0,1 -(Date.now()-(this.gameOverTime || Date.now()))/ 3000);var shakeForce = baseShake * decay;shakeX =(Math.random()- 0.5)* shakeForce * 2;shakeY =(Math.random()- 0.5)* shakeForce * 2;rotateAmplitude = Math.random()* 5 * decay;}else if(this.energy > 1.8){var shakeForce =(this.energy - 1.8)* 3;shakeX =(Math.random()- 0.5)* shakeForce;shakeY =(Math.random()- 0.5)* shakeForce;}this.gameContainer.style.transform = 'translate(' + shakeX + 'px,' + shakeY + 'px)scale(' + scale + ')rotate(' + rotate + 'deg)';}for(var i = this.particles.length - 1;i >= 0;i--){var p = this.particles[i];p.x += p.vx + this.targetVectors.x;p.y += p.vy + this.targetVectors.y;p.vx *= 0.98;p.vy *= 0.98;if(this.energy > 0.15){var dx =(this.width / 2)- p.x;var dy =(this.height / 2)- p.y;var dist = Math.sqrt(dx * dx + dy * dy)|| 1;var tx = -dy / dist;var ty = dx / dist;var swirlForce =(this.energy - 0.15)* 0.18;p.vx += tx * swirlForce;p.vy += ty * swirlForce;var gravity =(this.energy - 0.15)* 0.025;p.vx +=(dx / dist)* gravity;p.vy +=(dy / dist)* gravity;}if(p.x < 0)p.x = this.width;if(p.x > this.width)p.x = 0;if(p.y < 0)p.y = this.height;if(p.y > this.height)p.y = 0;p.life++;if(p.life > p.maxLife && this.particles.length > this.baseParticles){this.particles.splice(i,1);continue;}var currentAlpha = p.alphaBase *(1 + Math.sin(p.life * 0.1)* 0.3);this.ctx.beginPath();this.ctx.arc(p.x,p.y,p.size,0,Math.PI * 2);this.ctx.fillStyle = 'hsla(' + p.hue + ',80%,70%,' + currentAlpha + ')';this.ctx.fill();}};VisualEffectsManager.prototype.resetEffects = function(){this.energy = 0;this.progressFactor = 0;this.flashIntensity = 0;this.milestoneFlash = 0;this.heatDistortion = 0;this.staticIntensity = 0;this.gameOverShake = false;this.breathingPhase = 0;this.radarPhase = 0;this.staticNoiseTimer = 0;this.baseColor ={r:5,g:15,b:35};this.targetVectors ={x:0,y:0};this.radarRings = [];while(this.particles.length > this.baseParticles){this.particles.pop();}while(this.particles.length < this.baseParticles){this.particles.push(this.createParticle());}if(this.gameContainer){this.gameContainer.style.transform = '';}};function OxygenSystem(){this.indicator = null;this.currentLevel = 3;this.lastHours = 48;this.createIndicator();var self = this;if(window.gameManager && window.gameManager.eventBus){window.gameManager.eventBus.on('game:progression',function(data){self.updateFromSum(data.sum);});}}OxygenSystem.prototype.createIndicator = function(){this.indicator = document.createElement('div');this.indicator.id = 'oxygen-indicator';this.indicator.style.cssText = 'position:fixed;' + 'bottom:clamp(10px,2vh,20px);' + 'left:clamp(10px,2vw,20px);' + 'background:rgba(15,23,42,0.85);' + 'backdrop-filter:blur(12px);' + 'border:1px solid rgba(255,255,255,0.15);' + 'border-radius:8px;' + 'padding:clamp(6px,1.5vw,10px)clamp(12px,3vw,16px);' + 'font-family:"Outfit",sans-serif;' + 'font-size:clamp(10px,2.5vw,12px);' + 'z-index:1000;' + 'display:flex;' + 'align-items:center;' + 'gap:8px;' + 'box-shadow:0 4px 20px rgba(0,0,0,0.3);' + 'transition:all 0.3s ease;' + 'opacity:0;' + 'animation:fadeInOxygen 0.5s ease 1s forwards;';document.body.appendChild(this.indicator);var style = document.createElement('style');style.textContent = '@keyframes fadeInOxygen{to{opacity:1;}}' + '@keyframes criticalPulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:0.7;transform:scale(1.05);}}' + '@keyframes warningPulse{0%,100%{opacity:1;}50%{opacity:0.85;}}' + '@media(max-width:600px){#oxygen-indicator{font-size:10px !important;padding:6px 10px !important;gap:6px !important;}}' + '@media(max-height:500px)and(orientation:landscape){#oxygen-indicator{display:none !important;}}';document.head.appendChild(style);this.updateDisplay(48,3);};OxygenSystem.prototype.updateDisplay = function(hours,level){if(!this.indicator)return;var icon,color,text,statusText,animation;switch(level){case 0:icon = 'üî¥';color = '#ef4444';statusText = 'CR√çTICO';animation = 'criticalPulse 1s ease-in-out infinite';break;case 1:icon = 'üü†';color = '#f59e0b';statusText = 'BAJO';animation = 'warningPulse 2s ease-in-out infinite';break;case 2:icon = 'üü°';color = '#eab308';statusText = 'MEDIO';animation = 'none';break;default:icon = 'üü¢';color = '#10b981';statusText = 'ESTABLE';animation = 'none';}this.indicator.innerHTML = '<span style="font-size:16px;">' + icon + '</span>' + '<span style="color:' + color + ';font-weight:600;letter-spacing:0.5px;">' + statusText + '</span>' + '<span style="color:rgba(255,255,255,0.6);margin-left:4px;">O‚ÇÇ:</span>' + '<span style="color:' + color + ';font-weight:700;">' + hours + 'h</span>';this.indicator.style.animation = animation;this.indicator.style.borderColor = 'rgba(' + this.hexToRgb(color)+ ',0.3)';this.currentLevel = level;};OxygenSystem.prototype.updateFromSum = function(tileSum){var hours,level;if(tileSum < 200){hours = 48 - Math.floor(tileSum / 20);level = 3;}else if(tileSum < 1000){hours = 38 - Math.floor((tileSum - 200)/ 60);level = 2;}else if(tileSum < 2500){hours = 25 - Math.floor((tileSum - 1000)/ 120);level = 1;}else{hours = Math.max(1,12 - Math.floor((tileSum - 2500)/ 300));level = 0;}hours = Math.max(1,hours);if(hours !== this.lastHours){this.updateDisplay(hours,level);this.lastHours = hours;}if(level < this.currentLevel){this.playAlertSound(level);}this.currentLevel = level;};OxygenSystem.prototype.updateFromScore = function(score){};OxygenSystem.prototype.playAlertSound = function(level){if(window.gameManager && window.gameManager.eventBus){window.gameManager.eventBus.emit('oxygen:alert',{level:level});}};OxygenSystem.prototype.hexToRgb = function(hex){var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result ? parseInt(result[1],16)+ ',' + parseInt(result[2],16)+ ',' + parseInt(result[3],16):'255,255,255';};OxygenSystem.prototype.hide = function(){if(this.indicator){this.indicator.style.opacity = '0';}};OxygenSystem.prototype.show = function(){if(this.indicator){this.indicator.style.opacity = '1';}};function GameManager(size,InputManager,Actuator,StorageManager){this.size = size;this.inputManager = new InputManager;this.storageManager = new StorageManager;this.actuator = new Actuator;this.eventBus = new EventBus();this.soundManager = new SoundManager(this.eventBus);this.visualEffects = new VisualEffectsManager(this.eventBus);this.startTiles = 2;this.inputManager.on("move",this.move.bind(this));this.inputManager.on("restart",this.restart.bind(this));this.inputManager.on("keepPlaying",this.keepPlayingHandler.bind(this));this.inputManager.on("debugWin",this.debugWin.bind(this));this.inputManager.on("debugLose",this.debugLose.bind(this));this.setup();}GameManager.prototype.restart = function(){this.storageManager.clearGameState();this.actuator.continueGame();if(this.visualEffects){this.visualEffects.resetEffects();}if(window.oxygenSystem){window.oxygenSystem.currentLevel = 3;window.oxygenSystem.lastHours = 48;window.oxygenSystem.updateDisplay(48,3);}this.setup();};GameManager.prototype.keepPlayingHandler = function(){this.keepPlaying = true;this.actuator.continueGame();};GameManager.prototype.isGameTerminated = function(){return this.over ||(this.won && !this.keepPlaying);};GameManager.prototype.setup = function(){var previousState = this.storageManager.getGameState();if(previousState){this.grid = new Grid(previousState.grid.size,previousState.grid.cells);this.score = previousState.score;this.over = previousState.over;this.won = previousState.won;this.keepPlaying = previousState.keepPlaying;}else{this.grid = new Grid(this.size);this.score = 0;this.over = false;this.won = false;this.keepPlaying = false;this.addStartTiles();}this.actuate();};GameManager.prototype.addStartTiles = function(){for(var i = 0;i < this.startTiles;i++){this.addRandomTile();}};GameManager.prototype.addRandomTile = function(){if(this.grid.cellsAvailable()){var value = Math.random()< 0.9 ? 2:4;var tile = new Tile(this.grid.randomAvailableCell(),value);this.grid.insertTile(tile);}};GameManager.prototype.getTileSum = function(){var sum = 0;var maxTile = 0;this.grid.eachCell(function(x,y,tile){if(tile){sum += tile.value;if(tile.value > maxTile)maxTile = tile.value;}});return{sum:sum,maxTile:maxTile};};GameManager.prototype.actuate = function(){if(this.storageManager.getBestScore()< this.score){this.storageManager.setBestScore(this.score);}if(this.over){this.storageManager.clearGameState();}else{this.storageManager.setGameState(this.serialize());}var boardState = this.getTileSum();if(this.visualEffects){this.visualEffects.setGameProgress(boardState.maxTile,boardState.sum);}if(this.eventBus){this.eventBus.emit('game:progression',{sum:boardState.sum,maxTile:boardState.maxTile,score:this.score});}this.actuator.actuate(this.grid,{score:this.score,over:this.over,won:this.won,bestScore:this.storageManager.getBestScore(),terminated:this.isGameTerminated()});};GameManager.prototype.serialize = function(){return{grid:this.grid.serialize(),score:this.score,over:this.over,won:this.won,keepPlaying:this.keepPlaying};};GameManager.prototype.prepareTiles = function(){this.grid.eachCell(function(x,y,tile){if(tile){tile.mergedFrom = null;tile.savePosition();}});};GameManager.prototype.moveTile = function(tile,cell){this.grid.cells[tile.x][tile.y] = null;this.grid.cells[cell.x][cell.y] = tile;tile.updatePosition(cell);};GameManager.prototype.move = function(direction){var self = this;if(this.isGameTerminated())return;if(this.soundManager && !this.soundManager.initialized){this.soundManager.init();}var cell,tile;var vector = this.getVector(direction);var traversals = this.buildTraversals(vector);var moved = false;var maxMergeValue = 0;this.prepareTiles();traversals.x.forEach(function(x){traversals.y.forEach(function(y){cell ={x:x,y:y};tile = self.grid.cellContent(cell);if(tile){var positions = self.findFarthestPosition(cell,vector);var next = self.grid.cellContent(positions.next);if(next && next.value === tile.value && !next.mergedFrom){var merged = new Tile(positions.next,tile.value * 2);merged.mergedFrom = [tile,next];self.grid.insertTile(merged);self.grid.removeTile(tile);tile.updatePosition(positions.next);self.score += merged.value;if(merged.value > maxMergeValue){maxMergeValue = merged.value;}if(merged.value >= 64 && self.eventBus){self.eventBus.emit('game:milestone',{value:merged.value});}if(merged.value === 2048){self.won = true;if(self.eventBus){self.eventBus.emit('game:won');}}}else{self.moveTile(tile,positions.farthest);}if(!self.positionsEqual(cell,tile)){moved = true;}}});});if(moved){this.addRandomTile();if(!this.movesAvailable()){this.over = true;if(this.eventBus){this.eventBus.emit('game:over');}}this.eventBus.emit('game:move',{direction:direction});if(maxMergeValue > 0){this.eventBus.emit('game:merge',{value:maxMergeValue});}this.actuate();}};GameManager.prototype.getVector = function(direction){var map ={0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}};return map[direction];};GameManager.prototype.buildTraversals = function(vector){var traversals ={x:[],y:[]};for(var pos = 0;pos < this.size;pos++){traversals.x.push(pos);traversals.y.push(pos);}if(vector.x === 1)traversals.x = traversals.x.reverse();if(vector.y === 1)traversals.y = traversals.y.reverse();return traversals;};GameManager.prototype.findFarthestPosition = function(cell,vector){var previous;do{previous = cell;cell ={x:previous.x + vector.x,y:previous.y + vector.y};}while(this.grid.withinBounds(cell)&& this.grid.cellAvailable(cell));return{farthest:previous,next:cell};};GameManager.prototype.movesAvailable = function(){return this.grid.cellsAvailable()|| this.tileMatchesAvailable();};GameManager.prototype.tileMatchesAvailable = function(){var self = this;var tile;for(var x = 0;x < this.size;x++){for(var y = 0;y < this.size;y++){tile = this.grid.cellContent({x:x,y:y});if(tile){for(var direction = 0;direction < 4;direction++){var vector = self.getVector(direction);var cell ={x:x + vector.x,y:y + vector.y};var other = self.grid.cellContent(cell);if(other && other.value === tile.value){return true;}}}}}return false;};GameManager.prototype.positionsEqual = function(first,second){return first.x === second.x && first.y === second.y;};GameManager.prototype.debugWin = function(){var self = this;console.log('üéÆ DEBUG MODE:Auto-winning...');var availableCells = this.grid.availableCells();var targetCell = availableCells.length > 0 ? availableCells[0]:{x:0,y:0};if(this.grid.cells[targetCell.x][targetCell.y]){this.grid.removeTile(this.grid.cells[targetCell.x][targetCell.y]);}var winTile = new Tile(targetCell,2048);this.grid.insertTile(winTile);this.won = true;this.score += 2048;if(this.eventBus){this.eventBus.emit('game:merge',{value:2048});setTimeout(function(){if(self.eventBus){self.eventBus.emit('game:won');}},300);}this.actuate();};GameManager.prototype.debugLose = function(){console.log('üéÆ DEBUG MODE:Auto-losing...');var values = [2,4,8,16,32,64,128,256];var valueIndex = 0;for(var x = 0;x < this.size;x++){for(var y = 0;y < this.size;y++){if(this.grid.cells[x][y]){this.grid.removeTile(this.grid.cells[x][y]);}var value = values[valueIndex % values.length];var tile = new Tile({x:x,y:y},value);this.grid.insertTile(tile);valueIndex++;}}this.over = true;if(this.eventBus){this.eventBus.emit('game:over');}this.actuate();};function DebugOverlay(visualEffects,gameManager){var urlParams = new URLSearchParams(window.location.search);this.enabled = urlParams.get('debug')=== '1';if(!this.enabled)return;this.visualEffects = visualEffects;this.gameManager = gameManager;this.createOverlay();this.startUpdating();}DebugOverlay.prototype.createOverlay = function(){var overlay = document.createElement('div');overlay.id = 'debug-overlay';overlay.style.cssText = 'position:fixed;top:10px;right:10px;background:rgba(0,0,0,0.8);color:#0f0;font-family:monospace;font-size:12px;padding:15px;border-radius:8px;z-index:10000;min-width:250px;backdrop-filter:blur(10px);border:1px solid rgba(0,255,0,0.3);';overlay.innerHTML = '<div style="font-weight:bold;margin-bottom:10px;color:#0ff;">üéÆ DEBUG MODE</div>' + '<div id="debug-max-tile">Max Tile:-</div>' + '<div id="debug-tile-sum">Tile Sum:-</div>' + '<div id="debug-progress">Progress:-</div>' + '<div id="debug-energy">Energy:-</div>' + '<div id="debug-particles">Particles:-</div>' + '<div id="debug-phase">Phase:-</div>' + '<hr style="border-color:rgba(0,255,0,0.3);margin:10px 0;">' + '<div id="debug-flash">Flash:-</div>' + '<div id="debug-shake">Shake:-</div>' + '<div id="debug-swirl">Swirl:-</div>' + '<hr style="border-color:rgba(0,255,0,0.3);margin:10px 0;">' + '<div style="font-size:10px;color:#f59e0b;margin-top:8px;line-height:1.4;"><strong>Cheats:</strong><br>Alt+Shift+V = Victory üèÜ<br>Alt+Shift+X = eXplosion üí•</div>' + '<div style="font-size:10px;color:#888;margin-top:8px;">Remove ?debug=1 to hide</div>';document.body.appendChild(overlay);this.elements ={maxTile:document.getElementById('debug-max-tile'),tileSum:document.getElementById('debug-tile-sum'),progress:document.getElementById('debug-progress'),energy:document.getElementById('debug-energy'),particles:document.getElementById('debug-particles'),phase:document.getElementById('debug-phase'),flash:document.getElementById('debug-flash'),shake:document.getElementById('debug-shake'),swirl:document.getElementById('debug-swirl')};};DebugOverlay.prototype.getBoardState = function(){if(!this.gameManager || !this.gameManager.grid)return{maxTile:0,sum:0};var maxTile = 0;var sum = 0;this.gameManager.grid.eachCell(function(x,y,tile){if(tile){sum += tile.value;if(tile.value > maxTile)maxTile = tile.value;}});return{maxTile:maxTile,sum:sum};};DebugOverlay.prototype.getGamePhase = function(sum){if(sum < 200)return 'üõ∞Ô∏è Orbital';if(sum < 1000)return 'üåç Deorbit';if(sum < 2000)return '‚òÅÔ∏è Upper Atm';if(sum < 3000)return 'üî• Reentry';return 'üí• Critical';};DebugOverlay.prototype.getProgressBar = function(value,max){var percent = Math.round((value / max)* 100);var bars = Math.round(percent / 5);var filled = '‚ñà'.repeat(bars);var empty = '‚ñë'.repeat(20 - bars);return filled + empty + ' ' + percent + '%';};DebugOverlay.prototype.getColorForValue = function(value,max){var percent = value / max;if(percent < 0.3)return '#0f0';if(percent < 0.6)return '#ff0';if(percent < 0.8)return '#f80';return '#f00';};DebugOverlay.prototype.update = function(){if(!this.enabled || !this.visualEffects)return;var boardState = this.getBoardState();var maxTile = boardState.maxTile;var tileSum = boardState.sum;var progress = this.visualEffects.progressFactor || 0;var energy = this.visualEffects.energy || 0;var particleCount = this.visualEffects.particles ? this.visualEffects.particles.length:0;var flash = this.visualEffects.flashIntensity || 0;this.elements.maxTile.innerHTML = 'Max Tile:<span style="color:#ff0;font-weight:bold;">' + maxTile + '</span>';var sumColor = this.getColorForValue(tileSum,4000);this.elements.tileSum.innerHTML = 'Tile Sum:<span style="color:' + sumColor + ';font-weight:bold;">' + tileSum + '</span> <span style="color:#888;">/4000</span>';var progressColor = this.getColorForValue(progress,1.0);this.elements.progress.innerHTML = 'Progress:<span style="color:' + progressColor + ';">' + this.getProgressBar(progress,1.0)+ '</span>';var maxEnergy = 3.0;var energyColor = this.getColorForValue(energy,maxEnergy);this.elements.energy.innerHTML = 'Energy:<span style="color:' + energyColor + ';">' + this.getProgressBar(energy,maxEnergy)+ '</span> ' + energy.toFixed(2);var maxParticles = this.visualEffects.maxParticles || 300;var particleColor = this.getColorForValue(particleCount,maxParticles);this.elements.particles.innerHTML = 'Particles:<span style="color:' + particleColor + ';">' + particleCount + ' / ' + maxParticles + '</span>';var phase = this.getGamePhase(tileSum);this.elements.phase.innerHTML = 'Phase:<span style="color:#0ff;">' + phase + '</span>';var flashColor = this.getColorForValue(flash,2.0);this.elements.flash.innerHTML = 'Flash:<span style="color:' + flashColor + ';">' + flash.toFixed(3)+ '</span>';var shakeActive = energy > 1.8;var shakeColor = shakeActive ? '#f00':'#080';var shakeText = shakeActive ? '‚úì ACTIVE':'‚úó Inactive';this.elements.shake.innerHTML = 'Shake:<span style="color:' + shakeColor + ';">' + shakeText + '</span>(>' + '1.8)';var swirlActive = energy > 0.15;var swirlColor = swirlActive ? '#f80':'#080';var swirlText = swirlActive ? '‚úì ACTIVE':'‚úó Inactive';this.elements.swirl.innerHTML = 'Swirl:<span style="color:' + swirlColor + ';">' + swirlText + '</span>(>0.15)';};DebugOverlay.prototype.startUpdating = function(){if(!this.enabled)return;var self = this;setInterval(function(){self.update();},100);};window.requestAnimationFrame(function(){if(typeof ResponsiveHelper !== 'undefined'){window.responsiveHelper = new ResponsiveHelper();}if(typeof MissionBriefing !== 'undefined'){new MissionBriefing();}var gameManager = new GameManager(4,KeyboardInputManager,HTMLActuator,LocalStorageManager);window.gameManager = gameManager;if(typeof OxygenSystem !== 'undefined'){window.oxygenSystem = new OxygenSystem();}if(gameManager.eventBus){var initialState = gameManager.getTileSum();gameManager.eventBus.emit('game:progression',{sum:initialState.sum,maxTile:initialState.maxTile,score:gameManager.score});}if(typeof DebugOverlay !== 'undefined'){new DebugOverlay(gameManager.visualEffects,gameManager);}});</script></body></html>